<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Your Pinboard</title>

    <link href="https://fonts.googleapis.com/css?family=Roboto:100,100i,300,400,500" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <!--Tinymce Text-Editor (Must be in Head Tag) -->
    {% load staticfiles %}
    <script src="{% static '/js/tinymce/tinymce.min.js' %}"></script>
    <script type="text/javascript" src="{% static '/js/tinymce/custom.js' %}" ></script>

    <script
      src="https://code.jquery.com/jquery-3.3.1.min.js"
      integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
      crossorigin="anonymous">
    </script>

    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css" integrity="sha384-5sAR7xN1Nv6T6+dT2mhtzEpVJvfS3NScPQTrOxhwjIuvcA67KV2R5Jz6kr4abQsz" crossorigin="anonymous">


    <!-- Compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">

    <!-- Compiled and minified JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>

    {% load static %} 
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">

  </head>
  <body>
    <div class="background">

      <!--<a id="menu" class="waves-effect waves-light btn btn-floating" ><i class="material-icons">menu</i></a>-->

      <div class="backtotop">
        <img src="data:image/png;base64,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">
      </div>

      <!--&lt;!&ndash; Tap Target Structure &ndash;&gt;-->
      <!--<div class="tap-target" data-target="menu">-->
        <!--<div class="tap-target-content">-->
          <!--<h5>Title</h5>-->
          <!--<p>A bunch of text</p>-->
        <!--</div>-->
      <!--</div>-->

      <!-- side nav -->
      {% if request.session.username %}
        <ul id="slide-out" class="sidenav">
          <li><div class="user-view">
            <div class="background">
              <img src="https://i.imgur.com/G91dSvD.jpg">
            </div>
            {% if request.session.avatar %}
              <a href="#user" class="modal-trigger"><img class="circle" src='{{ request.session.avatar }}' id="user-avatar"></a>
            {% else %}
              <a href="#user" class="modal-trigger"><img class="circle" src="{% static '/images/empty-profile.png' %}" id="user-avatar"></a>
            {% endif %}
            <div class="profile-details-panel" style="background: rgba(255,255,255,0.6);border-radius: 8px;">
                <!--<a href="#email"><span class="black-text name">Mike</span></a>-->
                <a href="#name"><span class="black-text name">{{ request.session.username }}</span></a>
                <!--<a href="#email"><span class="black-text email">example@gmail.com</span></a>-->
              <a href="#email"><span class="black-text email">{{ request.session.useremail }}</span></a>
            </div>

          </div></li>
          <li><a class="waves-effect" href="/blogs/create"><i class="material-icons">add_box</i>Create Post</a></li>
          <li><a class="waves-effect modal-trigger" href="#modal1"><i class="material-icons">account_box</i>Manage Account</a></li>
          <li><div class="divider"></div></li>
          <li><a class="waves-effect" href="/blogs/logout"><i class="material-icons">exit_to_app</i>Logout</a></li>
        </ul>
      {% endif %}

      <!-- Modal Structure -->
      <div id="modal1" class="modal">
        <div class="modal-content">
          <h4>Change Password</h4>
          <form  method="post">
            <input type="password" placeholder="newpassword" class="newpassword">
            <input type="password" placeholder="confirm" class="renewpassword">
          </form>
          <div class="msgforreset1" style="color: red; display: none;">Please confirm the password</div>
          <div class="msgforreset2" style="color: red; display: none;">Successful</div>
        </div>
        <div class="modal-footer">
          <a href="#!" class="waves-effect waves-light btn resetpassword">Submit</a>
        </div>
      </div>

      <!--Upload Avatar Modal-->
      <!--<form method="POST" action="{% url 'shared:user_avatar' %}">-->
      <div id="user" class="modal">
        <div class="modal-content">
          <h5 style="font-weight:100;text-align: center;margin-bottom: 24px">Upload Avatar</h5>
          <div class="row">
            <div class="col s12 m4">
              {% if request.session.avatar %}
                <img id='uploaded-avatar' src="{{request.session.avatar}}" style="width:180px;height:180px;">
              {% else %}
                <img id='uploaded-avatar' src="{% static '/images/empty-profile.png' %}" style="width:180px;height:180px;">
              {% endif %}
            </div>
            <div class="col s12 m8">
              <div class="row">
                <input name="avatar" accept="image/*" required="" id="id_avatar" autocomplete="off" type="file">
                <!--{{ form.as_p }}-->
              </div>
              <div class="row">
                <button type="submit" id="submit-avatar" class="waves-effect waves-light btn-small cyan lighten-1">Submit</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- nav bar -->
      <nav class="nav-container pinboard">
        <div class="nav-wrapper transparent">
          <a href="/" class="brand-logo pinboard"><i class="large material-icons">event_note</i>Pinboard</a>
          <ul class="right hide-on-med-and-down">
            <!-- <li><a class="waves-effect modal-trigger" data-target="create-post-modal" href="#create-post-modal"><i class="material-icons">add_box</i>Create Post</a></li> -->
            {% if request.session.username %}
            <li><a class="waves-effect waves-light btn-small  orange lighten-1 modal-trigger" data-target="create-post-modal" href="#create-post-modal"><i class="material-icons right">add_box</i>Create Post</a></li>
            {% endif %}
            {% if request.session.username and request.session.username.strip %}
              <li><span>Hello, {{ request.session.username }}&nbsp;</span></li>
            {% else %}
              <!--<li><a class="waves-effect waves-light btn-flat white-text" style="margin-left: 0;margin-right: 0;" href="/blogs/register">Register</a></li>-->
              <!--<li><a class="waves-effect waves-light btn-flat white-text" style="margin-left: 0;margin-right: 0;" href="/blogs/login">Login</a></li>-->
            {% endif %}
            <li><a href="#" data-target="slide-out" class="sidenav-trigger" style="display: block !important"><i class="material-icons">menu</i></a></li>
          </ul>
        </div>
      </nav>

      <!-- create-a-post modal -->
      <div id="create-post-modal" class="modal grey lighten-2" style="max-width: 600px;">
        <div class="modal-content" style="min-height: 200px;">
          <h5 style="font-weight:100;text-align: center;margin-bottom: 24px">What type of post would you like to create?</h5>
          <div style="display:flex;justify-content: space-evenly">
            <a href="/blogs/create">
              <div class="card-panel waves-light  waves-effect post-type amber" style="display:flex;align-items: center;justify-content: center;width:150px;height:125px">
                <i class="material-icons" style="color: white">event_note</i>
                <span class="white-text">&nbsp;Article</span>
              </div>
            </a>
            <a href="/blogs/createImagePost">
              <div class="card-panel waves-light waves-effect post-type cyan lighten-1" style="display:flex;align-items: center;justify-content: center;width:150px;height:125px">
                <i class="material-icons" style="color: white">insert_photo</i>
                <span class="white-text">&nbsp;Image</span>
              </div>
            </a>
            <!--<a id="toggle-image-post-form">-->
              <!--<div class="card-panel waves-light waves-effect post-type cyan lighten-1" style="display:flex;align-items: center;justify-content: center;width:150px;height:125px">-->
                <!--<i class="material-icons" style="color: white">insert_photo</i>-->
                <!--<span class="white-text">&nbsp;Image</span>-->
              <!--</div>-->
            <!--</a>-->
            <a href="/blogs/createQuestion">
              <div class="card-panel waves-light waves-effect post-type light-green lighten-1" style="display:flex;align-items: center;justify-content: center;width:150px;height:125px">
                <i class="material-icons" style="color: white">question_answer</i>
                <span class="white-text">&nbsp;Question</span>
              </div>
            </a>
          </div>
          <!-- <div class="input-field">
            <select>
              <option value="1">Article</option>
              <option value="2">Question</option>
              <option value="3">Image</option>
            </select>
            <label>Type of post</label>
          </div>
          <h5>Enter an image URL below</h5>
          <div class="input-field">
            <input id="image-url" type="text" class="validate">
          </div> -->
        </div>
        <div id="submit-image-post">
          <form style="margin: 0;" action="/blogs/createImagePost/" method="POST">
            {% csrf_token %}
            <div class="image-post-form-container">
              <input type="text" placeholder="Title" name="title" style="max-width: 200px">
              <input type="text" placeholder="Image URL" name="detail" style="max-width: 200px">
              <button type="submit" class="waves-effect waves-light btn-small cyan lighten-1">Submit</button>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <a href="#!" class="modal-close waves-effect waves-green btn-flat">Cancel</a>
        </div>
      </div>

      <div class="container pinboard">
        <div class="row">
            <div class="col s12">
                {% block content %}
                {% endblock %}
            </div>
        </div>
      </div>

    </div>

    <!--<div class="backtotop">回到顶部</div>-->



    <script>
      document.getElementById('id_avatar').onchange = (e) => {uploadAvatar(e)};
      function uploadAvatar(event) {
        const [ file ] = event.target.files;

        const validFileTypes = [ 'image/jpeg', 'image/png', 'image/jpg' ];
        const valid = validFileTypes.find(type => type === file.type);

        if (!valid) return false;

        const reader = new FileReader();

        reader.onload = (e) => {
          const dataURL = e.target.result;
          let img = document.getElementById('uploaded-avatar');
          img.src = dataURL;
        };

        reader.readAsDataURL(file);
      }

      document.getElementById('submit-avatar').addEventListener('click', event => {
        fetch("{% url 'shared:user_avatar' %}", {
          method: 'POST',
          headers: { 'Content-Type': 'application/json', 'X-CSRFToken': "{{ csrf_token }}" },
          body: JSON.stringify({
            'avatar': document.getElementById('uploaded-avatar').src
          })
        }).then(res => res.json()).then(json => {
            if (json.message === 'Succeed') {
                document.getElementById('user-avatar').src=document.getElementById('uploaded-avatar').src;
                $('#user').modal('hide');
            }
        });
      });

      // initialize various handlers
      $(document).ready(() => {
        const options = { edge: 'right' };
        $('.sidenav').sidenav(options);
        // $('.sidenav').sidenav('open');
        $('.modal').modal();
        $('select').formSelect();
      });

      // handle pressing of upvote/downvote button
      $('.btn-flat.vote').click(event => {
        const postID = $(event.target).attr('post_id');
        let scoreValue = $(`#score-${postID}`).text(); 
        if (event.target.id.indexOf('upvote') > -1) {
          $(`#score-${postID}`).text(++scoreValue);
        } else if (event.target.id.indexOf('downvote') > -1) {
          $(`#score-${postID}`).text(--scoreValue);
        }
      });

      //toggle image post form
      $('#toggle-image-post-form').click(event => {
        $('#submit-image-post').slideToggle('fast');

      });

      (function(d, t) {
        var g = d.createElement(t),
                s = d.getElementsByTagName(t)[0];
        g.src = '//hnbutton.appspot.com/static/hn.min.js';
        s.parentNode.insertBefore(g, s);
      }(document, 'script'));


      $('.resetpassword').click(event => {

        console.log($('.newpassword').val());
        console.log($('#password').text());
        $.ajax({
          url: "/blogs/reset/",
          type: 'GET',
          data: {
            'newpassword': $('.newpassword').val(),
            'renewpassword': $('.renewpassword').val(),
            'password': $('#password').text()

           },
          success: function (data) {
              if (data == 'Done'){
                $(".msgforreset2").css("display","block");
                $(".msgforreset1").css("display","none");
              }else if ('Password is not matched'){
                $(".msgforreset1").css("display","block");
                $(".msgforreset2").css("display","none");
              }


          }
        })
      });


      function showTop()
      {
        var scrollTop=document.body.scrollTop;
        if (scrollTop > 300){
          $('.backtotop').css('display', 'block');
        }else{
          $('.backtotop').css('display', 'none');
        }

      }
      setInterval("showTop()","1000");

      var timer = null;

      $('.backtotop').click(event => {


          timer=setInterval(function(){
          var osTop=document.documentElement.scrollTop|| document.body.scrollTop;
          var ispeed=Math.floor(-osTop / 5);
          isTop = true;
          document.documentElement.scrollTop=document.body.scrollTop = osTop+ispeed;

          if(osTop==0){
            clearInterval(timer);
          }
        },30);

      })

    </script>

  </body>
</html>